<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8"><meta name="generator" content="Hugo 0.83.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Hugo Caddy V2ray on Ubuntu and filebrowser&nbsp;&ndash;&nbsp;蜀山小筑</title><link rel="stylesheet" href="/css/core.min.2b84579068bd8ec3d1cd26c1d4177c5a85fee2eba66d7cd5aa289e9b7aef0a612b119e4bc14d850c83d270f4b192374c.css" integrity="sha384-K4RXkGi9jsPRzSbB1Bd8WoX&#43;4uumbXzVqiiem3rvCmErEZ5LwU2FDIPScPSxkjdM"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hugo Caddy V2ray on Ubuntu and filebrowser" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><img class="site logo" src="/img/logo.png" alt /><span class="site name">蜀山小筑</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/">主页</a><a class="nav item" href="/tags">标签</a><a class="nav item" href="/categories">分类</a><a class="nav item" href="/about">关于我</a></nav></div></span></div><div class="site slogan"><span class="title">「少即多,慢则快」</span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Hugo Caddy V2ray on Ubuntu and filebrowser</h1><p class="article date">Sunday, November 10, 2019</p></section><article class="article markdown-body"><h2 id="一前言">一、前言</h2>
<p>这个教程绝大部分内容你都可以复制粘贴，但是请仔细阅读代码框里面的备注，也就是<code>#</code>后面的文字。</p>
<p>:u7981:必须修改代码里面的参数，否则不可能成功！有问题就留言吧，祝你好运。</p>
<h2 id="二必要条件">二、必要条件</h2>
<h3 id="1--ubuntu服务器">1.  Ubuntu服务器</h3>
<h3 id="2-域名">2. 域名</h3>
<h3 id="3-域名绑定服务器的ip-地址">3. 域名绑定服务器的IP 地址</h3>
<h2 id="三hugo">三、Hugo</h2>
<h3 id="1安装-hugo">1.安装 Hugo</h3>
<p>先去 <a href="https://github.com/gohugoio/hugo/releases"target="_blank" rel="noopener noreferrer">Hugo release</a>
查看 Hugo的最新版本，用最新版本号替代下面代码里面的0.59.1，你也可以直接复制下面的代码，进行下载和安装。</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#使用 wget 下载 hugo</span>
wget https://github.com/gohugoio/hugo/releases/download/v0.59.1/hugo_0.59.1_Linux-64bit.deb
<span class="c1">#使用 dpkg 安装 .deb 文件</span>
sudo dpkg -i hugo_0.59.1_Linux-64bit.deb
</code></pre></div><h3 id="2创建网站存放目录">2.创建网站存放目录</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 使用 mkdir命令，创建网站目录</span>
mkdir -p /var/www
<span class="c1"># 使用 cd命令，进入创建的目录</span>
<span class="nb">cd</span> /var/www
<span class="c1"># 新建站点，名字为3cho,你可以替换成自己的名字</span>
hugo new site suan
</code></pre></div><h3 id="3安装主题">3.安装主题</h3>
<p>如果没有安装 git先安装</p>
<h3 id="31安装-git">3.1安装 git</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">apt-get update
apt-get install git
</code></pre></div><p>###3.2 安装主题
主题可以去Hugo<a href="https://themes.gohugo.io/"target="_blank" rel="noopener noreferrer">官方主题库</a>
下载,本文以 <a href="https://github.com/olOwOlo/hugo-theme-even"target="_blank" rel="noopener noreferrer">even</a>
 主题为例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 进入新建好的suan目录</span>
<span class="nb">cd</span> /var/www/suan
<span class="c1"># 安装主题（不同主题安装方式不同）</span>
git clone https://github.com/olOwOlo/hugo-theme-even themes/even
<span class="c1">#复制主题自带的 config.toml文件到当前根目录</span>
cp themes/even/exampleSite/config.toml ./config.toml
</code></pre></div><h3 id="4创建一篇测试新文章">4.创建一篇测试新文章</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">hugo new post/hello.md
</code></pre></div><h3 id="5生成博客静态博客">5.生成博客静态博客</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 生成静态网页，包括草稿，生成好的内容在public目录中</span>
hugo -D
</code></pre></div><h2 id="四github">四、GitHub</h2>
<pre><code>如果你以后不想通过 github管理文章，这里可以跳过。
</code></pre><h3 id="1新建一个github仓库">1.新建一个Github仓库</h3>
<p>输完仓库名字后，按 <kbd>enter</kbd> 。
<img  src="https://img.yaleax.com/Screen-Recording-2019-11-17-20-13-44.gif"
        alt/></p>
<h3 id="2初始化-github">2.初始化 GitHub</h3>
<p>这些命令完成后，会上传全部Hugo博客源码到 GitHub</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">#仓库名字repository以hellotest为例</span>
<span class="nb">echo</span> <span class="s2">&#34;# hellotest&#34;</span> &gt;&gt; README.md
git init
git add .
git commit -m <span class="s2">&#34;first commit&#34;</span>
git remote add origin git@github.com:替换成你的GitHub用户名/hellotest.git
git push -u origin master
</code></pre></div><h2 id="五v2ray">五、V2ray</h2>
<h3 id="1更新为上海时间">1.更新为上海时间</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
date -R
</code></pre></div><h3 id="2安装-v2ray">2.安装 V2ray</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">wget https://install.direct/go.sh
sudo bash go.sh
</code></pre></div><h3 id="3编辑v2ray配置">3.编辑v2ray配置</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">rm /etc/v2ray/config.json
nano /etc/v2ray/config.json
</code></pre></div><h3 id="4v2ray-配置内容">4.v2ray 配置内容</h3>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;inbounds&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">30123</span><span class="p">,</span>
      <span class="nt">&#34;listen&#34;</span><span class="p">:</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span> <span class="err">//只监听</span> <span class="err">127.0.0.1，避免除本机外的机器探测到开放了</span> <span class="err">30123</span> <span class="err">端口</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;vmess&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;clients&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;b831381d-6324-4d53-ad4f-8cda48b30811&#34;</span><span class="p">,</span>
            <span class="nt">&#34;alterId&#34;</span><span class="p">:</span> <span class="mi">64</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;streamSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="s2">&#34;ws&#34;</span><span class="p">,</span>
        <span class="nt">&#34;wsSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/ray30123&#34;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&#34;outbounds&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;freedom&#34;</span><span class="p">,</span>
      <span class="nt">&#34;settings&#34;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><pre><code>修改完成后，你需要同时按 &lt;kbd&gt;ctrl&lt;/kbd&gt; + &lt;kbd&gt;x&lt;/kbd&gt;来退出,再输入&lt;kbd&gt;y&lt;/kbd&gt;确认保存，再按 &lt;kbd&gt;enter&lt;/kbd&gt; 保存。
</code></pre><h3 id="5v2ray-控制命令">5.V2ray 控制命令</h3>
<pre><code>sudo systemctl start v2ray     # 启动v2ray  
sudo systemctl status v2ray    # 查看v2ray状态  
sudo systemctl stop v2ray      # 停止v2ray  
sudo systemctl restart v2ray   # 重新启动v2ray
</code></pre><h3 id="6启动-v2ray并查看状态">6.启动 V2ray并查看状态</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo systemctl start v2ray    
sudo systemctl status v2ray
</code></pre></div><h3 id="7暂停-v2ray">7.暂停 V2ray</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo systemctl stop v2ray
</code></pre></div><h2 id="六filebrowser">六、Filebrowser</h2>
<h3 id="1安装-filebrowser">1.安装 Filebrowser</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">curl -fsSL https://filebrowser.xyz/get.sh <span class="p">|</span> bash
</code></pre></div><p>安装目录：<code>/usr/local/bin/filebrowser</code></p>
<h3 id="2创建-filebrowser配置文件">2.创建 Filebrowser配置文件</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mkdir /etc/filebrowser
mkdir /etc/filebrowser/filebrowser
nano /etc/filebrowser/filebrowser.json
</code></pre></div><h3 id="3filebrowserjson配置信息">3.Filebrowser.json配置信息</h3>
<p>把这些信息复制进去</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">18888</span><span class="p">,</span>
  <span class="nt">&#34;baseURL&#34;</span><span class="p">:</span> <span class="s2">&#34;/admin&#34;</span><span class="p">,</span>
  <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span>
  <span class="nt">&#34;log&#34;</span><span class="p">:</span> <span class="s2">&#34;stdout&#34;</span><span class="p">,</span>
  <span class="nt">&#34;database&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/www/suan/database.db&#34;</span><span class="p">,</span>
  <span class="nt">&#34;root&#34;</span><span class="p">:</span> <span class="s2">&#34;/var/www&#34;</span>
<span class="p">}</span>
</code></pre></div><h3 id="4设置filebrowser系统服务文件">4.设置Filebrowser系统服务文件</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">nano /etc/systemd/system/filebrowser.service
</code></pre></div><h3 id="5filebrowserservice配置文件">5.filebrowser.service配置文件</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>File Browser
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/filebrowser -c /etc/filebrowser/filebrowser.json

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div><h3 id="6重新载入systemctl">6.重新载入systemctl</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">systemctl daemon-reload
</code></pre></div><h3 id="7启动-filebrowser">7.启动 filebrowser</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">systemctl start filebrowser

</code></pre></div><pre><code>修改完成后，你需要同时按 &lt;kbd&gt;ctrl&lt;/kbd&gt; + &lt;kbd&gt;x&lt;/kbd&gt;来退出,再输入&lt;kbd&gt;y&lt;/kbd&gt;确认保存，再按 &lt;kbd&gt;enter&lt;/kbd&gt; 保存。
</code></pre><p>http://你的ip:1888/admin<br>
帐号:<code>admin</code><br>
密码:<code>admin</code></p>
<h3 id="9启动-https">9.启动 https</h3>
<p>启动 https后面会介绍，利用 Caddy 反代,添加一句，后面 Caddy 配置文件我会加进去。<br>
<code>proxy /admin 127.0.0.1:18888 \\反代 filebreowser</code></p>
<h2 id="七caddy">七、Caddy</h2>
<h3 id="1安装-caddy">1.安装 Caddy</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/caddy_install.sh <span class="o">&amp;&amp;</span> chmod +x caddy_install.sh <span class="o">&amp;&amp;</span> bash caddy_install.sh install http.filemanager http.git
<span class="c1">#备用地址</span>
wget -N --no-check-certificate https://www.moerats.com/usr/shell/Caddy/caddy_install.sh <span class="o">&amp;&amp;</span> chmod +x caddy_install.sh <span class="o">&amp;&amp;</span> bash caddy_install.sh~
</code></pre></div><h3 id="2设置-cadddy所需要的目录">2.设置 Cadddy所需要的目录</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 建立配置文件，更改文件所有权</span>
mkdir /usr/local/caddy/
touch /usr/local/caddy/Caddyfile
chown -R root:www-data /usr/local/caddy/
<span class="c1"># 建立日志目录，给与写入权限</span>
mkdir /var/log/caddy
touch /var/log/caddy/access.log
chown -R www-data:root /var/log/caddy
chmod <span class="m">0666</span> /var/log/caddy/access.log
</code></pre></div><h3 id="3编辑-caddy配置文件">3.编辑 Caddy配置文件</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">nano /usr/local/caddy/Caddyfile
</code></pre></div><h3 id="4caddy配置文件">4.Caddy配置文件</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">suan.su
<span class="o">{</span>
  gzip
  tls 123456212@mail.com
  log /var/log/caddy/access.log
  root /var/www/suan/public
  proxy /admin 127.0.0.1:18888 <span class="se">\\</span>反代 filebreowser
  proxy /ray30123 localhost:30123 <span class="o">{</span>
    websocket
    header_upstream -Origin
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><pre><code>修改完成后，你需要同时按 &lt;kbd&gt;ctrl&lt;/kbd&gt; + &lt;kbd&gt;x&lt;/kbd&gt;来退出,再输入&lt;kbd&gt;y&lt;/kbd&gt;确认保存，再按 &lt;kbd&gt;enter&lt;/kbd&gt; 保存。  
</code></pre><h3 id="5caddy文件说明">5.Caddy文件说明</h3>
<p>安装目录：<code>/usr/local/caddy/</code><br>
Caddy配置文件位置：<code>/usr/local/caddy/Caddyfile</code><br>
Caddy自动申请SSL证书位置：<code>/.caddy/acme/acme-v02.api.letsencrypt.org/sites/xxx.xxx(域名)/</code></p>
<h3 id="6caddy-控制命令">6.Caddy 控制命令</h3>
<pre><code>启动：/etc/init.d/caddy start  
停止：/etc/init.d/caddy stop  
重启：/etc/init.d/caddy restart  
查看状态：/etc/init.d/caddy status  
查看Caddy启动日志：tail -f /tmp/caddy.log  
</code></pre><h3 id="7启动-caddy服务并查询状态">7.启动 Caddy服务并查询状态</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">/etc/init.d/caddy start
sudo systemctl start v2ray    
tail -f /tmp/caddy.log 
</code></pre></div><p>:tada: 完成！访问自己的域名试试吧!</p>
<h3 id="71-安装-bbrplus">7.1 安装 bbrplus</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">wget -N --no-check-certificate <span class="s2">&#34;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&#34;</span>
chmod +x tcp.sh
./tcp.sh
</code></pre></div><h2 id="八后话">八、后话</h2>
<p>如果你当正常博客使用，你还需要把下面这些坑填上。</p>
<ol>
<li><input disabled="" type="checkbox"> 修改Hugo博客配置文件。</li>
<li><input disabled="" type="checkbox"> V2ray客户端配置教程。</li>
<li><input checked="" disabled="" type="checkbox"> Caddy自动化配置。</li>
<li><input disabled="" type="checkbox"> 使用GitHub更新博客文章。</li>
</ol>
</article><section class="article labels"><a class="tag" href=/tags/v2ray/>v2ray</a><a class="tag" href=/tags/caddy/>Caddy</a><a class="tag" href=/tags/hugo/>Hugo</a></section><section class="article license">版权声明：如果转发请带上本文链接和注明来源。</section><section class="article author"><img class="avatar" src="/img/avatar.jpg" alt><p class="name">愚道</p><div class="bio">求知若渴，虚心若愚</div><div class="details"><a class="item" href="https://github.com/YALEAX" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;YALEAX</a><a class="item" href="mailto:Qu@JzE.us" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-email"></span>&nbsp;Qu@JzE.us</a></div>
</section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/post/hello-world/"><span class="iconfont icon-article"></span>使用 Backblaze和Cloudflare Workers搭建可以自定义域名的免费图床 </a></p><p><a class="link" href="/post/%E4%BD%BF%E7%94%A8stackbit-%E6%9D%A5%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/"><span class="iconfont icon-article"></span>使用Stackbit 来快速搭建静态博客</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">©2021 蜀山小筑.</p>
    <p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div>
</section><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/&#43;DiW/UqRcLbRjq" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l&#43;B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd&#43;qj&#43;o24G5ZU2zJz" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
            onload="renderMathInElement(document.body);"></script></body>

</html>