<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8"><meta name="generator" content="Hugo 0.83.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>使用 Certbot手动获取 Let&#39;s Encrypt 免费证书Caddy手动配置证书&nbsp;&ndash;&nbsp;蜀山小筑</title><link rel="stylesheet" href="/css/core.min.2b84579068bd8ec3d1cd26c1d4177c5a85fee2eba66d7cd5aa289e9b7aef0a612b119e4bc14d850c83d270f4b192374c.css" integrity="sha384-K4RXkGi9jsPRzSbB1Bd8WoX&#43;4uumbXzVqiiem3rvCmErEZ5LwU2FDIPScPSxkjdM"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="使用 Certbot手动获取 Let&#39;s Encrypt 免费证书Caddy手动配置证书" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><img class="site logo" src="/img/logo.png" alt /><span class="site name">蜀山小筑</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/">主页</a><a class="nav item" href="/tags">标签</a><a class="nav item" href="/categories">分类</a><a class="nav item" href="/about">关于我</a></nav></div></span></div><div class="site slogan"><span class="title">「少即多,慢则快」</span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">使用 Certbot手动获取 Let's Encrypt 免费证书Caddy手动配置证书</h1><p class="article date">Tuesday, November 19, 2019</p></section><article class="article markdown-body"><h2 id="一前言">一、前言</h2>
<p>之前写了一个教程是利用 Caddy 自动获得证书得，最近总是失败，所以就选择手动获取，然后再配置 Caddy。首先我们需要从证书授权机构(以下简称 CA ) 处获取一个证书，Let&rsquo;s Encrypt 就是一个 CA。
<a href="https://letsencrypt.org"target="_blank" rel="noopener noreferrer">Let&rsquo;s Encrypt</a>
 是一个免费、开放，自动化的证书颁发机构，Caddy自动申请得也是这家。
<a href="https://certbot.eff.org"target="_blank" rel="noopener noreferrer">Certbot</a>
 是 Let’s Encrypt 官方推荐的证书生成客户端工具</p>
<h2 id="二教程">二、教程</h2>
<h3 id="1安装-cerbot">1.安装 Cerbot</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 下载 Certbot 客户端</span>
wget https://dl.eff.org/certbot-auto

<span class="c1"># 设为可执行权限</span>
chmod a+x certbot-auto
</code></pre></div><h3 id="2申请通配符证书">2.申请通配符证书</h3>
<p>Let’s Encrypt目前支持三种验证方式：</p>
<ul>
<li>dns-01：给域名添加一个 DNS TXT 记录。</li>
<li>http-01：在域名对应的 Web 服务器下放置一个 HTTP well-known URL 资源文件。</li>
<li>tls-sni-01：在域名对应的 Web 服务器下放置一个 HTTPS well-known URL 资源文件。</li>
</ul>
<p>下面以 dns验证方式为例</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">./certbot-auto certonly  -d <span class="s2">&#34;*.xxx.com&#34;</span> --manual --preferred-challenges dns-01  --server https://acme-v02.api.letsencrypt.org/directory
</code></pre></div><pre><code>1.申请通配符证书，只能使用 dns-01 的方式。  
2.`xxx.com` 请根据自己的域名自行更改。
</code></pre><p>等待安装一些相关环境文件，接下来的操作参考下面得图片</p>
<p><img  src="https://img.yaleax.com/le_ssl_01.png"
        alt/></p>
<h3 id="3更改dnstxt">3.更改dnstxt</h3>
<p>测试验证</p>
<pre><code>dig -t txt _acme-challenge.xxx.com@8.8.8.8 
</code></pre><p>确认生效后，回车继续执行，最后会输出如下内容：</p>
<pre><code>IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/xxx.com/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/xxx.com/privkey.pem
   Your cert will expire on 2018-06-12. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot-auto
   again. To non-interactively renew *all* of your certificates, run
   &quot;certbot-auto renew&quot;
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le
</code></pre><p>到了这一步后，恭喜您，证书申请成功。 证书和密钥保存在下列目录：</p>
<pre><code>tree /etc/letsencrypt/live/xxx.com/
.
├── cert.pem
├── chain.pem
├── fullchain.pem
└── privkey.pem
</code></pre><p>校验证书信息，输入如下命令：</p>
<pre><code>openssl x509 -in  /etc/letsencrypt/live/xxx.com/cert.pem -noout -text 

# 可以看到证书包含了 SAN 扩展，该扩展的值就是 *.xxx.com
...
Authority Information Access: 
        OCSP - URI:http://ocsp.int-x3.letsencrypt.org
        CA Issuers - URI:http://cert.int-x3.letsencrypt.org/

X509v3 Subject Alternative Name: 
    DNS:*.xxx.com
...
</code></pre><p>到此，我们就演示了如何在 Let’s Encrypt 申请免费的通配符证书。</p>
<h2 id="三caddy-配置">三、Caddy 配置</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">example.moe
gzip
log /var/log/caddy/access.log
tls /etc/ssl/cert.pem /etc/ssl/key.pem
root /var/www/

</code></pre></div><hr>
<p>[参考1]<a href="https://youlu.tk/#header-n703">https://youlu.tk/#header-n703</a></p>
</article><section class="article labels"><a class="tag" href=/tags/caddy/>Caddy</a><a class="tag" href=/tags/%E8%AF%81%E4%B9%A6/>证书</a></section><section class="article license">版权声明：如果转发请带上本文链接和注明来源。</section><section class="article author"><img class="avatar" src="/img/avatar.jpg" alt><p class="name">愚道</p><div class="bio">求知若渴，虚心若愚</div><div class="details"><a class="item" href="https://github.com/YALEAX" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;YALEAX</a><a class="item" href="mailto:Qu@JzE.us" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-email"></span>&nbsp;Qu@JzE.us</a></div>
</section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/post/vps%E8%BF%9E%E6%8E%A5-google-drive/"><span class="iconfont icon-article"></span>VPS连接 Google Drive</a></p><p><a class="link" href="/post/clash-%E6%95%99%E7%A8%8B/"><span class="iconfont icon-article"></span>在 ubuntu服务器上安装Clash </a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">©2021 蜀山小筑.</p>
    <p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div>
</section><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/&#43;DiW/UqRcLbRjq" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l&#43;B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd&#43;qj&#43;o24G5ZU2zJz" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
            onload="renderMathInElement(document.body);"></script></body>

</html>